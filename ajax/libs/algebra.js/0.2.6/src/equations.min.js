var Expression=require("./expressions").Expression,Variable=require("./expressions").Variable,Term=require("./expressions").Term,Fraction=require("./fractions"),isInt=require("./helper").isInt,Equation=function(t,r){if(!(t instanceof Expression))throw new TypeError("Invalid Argument ("+t.toString()+"): Left-hand side must be of type Expression.");if(this.lhs=t,r instanceof Expression)this.rhs=r;else{if(!(r instanceof Fraction||isInt(r)))throw new TypeError("Invalid Argument ("+r.toString()+"): Right-hand side must be of type Expression, Fraction or Integer.");this.rhs=new Expression(r)}};Equation.prototype.solveFor=function(t){if(!this.lhs._hasVariable(t)&&!this.rhs._hasVariable(t))throw new TypeError("Invalid Argument ("+t.toString()+"): Variable does not exist in the equation.");if(this._isLinear()||this._variableCanBeIsolated(t)){for(var r=new Term(new Variable(t)),i=new Expression,e=new Expression,a=0;a<this.rhs.terms.length;a++){var s=this.rhs.terms[a];s.canBeCombinedWith(r)?i=i.subtract(s):e=e.add(s)}for(var a=0;a<this.lhs.terms.length;a++){var s=this.lhs.terms[a];s.canBeCombinedWith(r)?i=i.add(s):e=e.subtract(s)}if(e=e.subtract(this.lhs.constant()),e=e.add(this.rhs.constant()),0===i.terms.length){if(i.constant().equalTo(e.constant()))return new Fraction(1,1);throw new EvalError("No Solution")}return e=e.divide(i.terms[0].coefficient()),0===e.terms.length?e.constant().reduce():(e._sort(),e)}var i=this.lhs.copy();if(i=i.subtract(this.rhs),0===i.terms.length){if(0===i.constant().valueOf())return[new Fraction(1,1)];throw new EvalError("No Solution")}if(this._isQuadratic(t)){var o=i._quadraticCoefficients(),n=o.a,l=o.b,u=o.c,h=l.pow(2).subtract(n.multiply(u).multiply(4));if(h.valueOf()>=0){if(0===h.valueOf())return[l.multiply(-1).divide(n.multiply(2)).reduce()];var p;if(h._squareRootIsRational()){p=h.pow(.5);var c=l.multiply(-1).subtract(p).divide(n.multiply(2)),f=l.multiply(-1).add(p).divide(n.multiply(2));return[c.reduce(),f.reduce()]}p=Math.sqrt(h.valueOf()),n=n.valueOf(),l=l.valueOf();var c=(-l-p)/(2*n),f=(-l+p)/(2*n);return[c,f]}return[]}if(this._isCubic(t)){var o=i._cubicCoefficients(),n=o.a,l=o.b,u=o.c,m=o.d,y=n.multiply(l).multiply(u).multiply(m).multiply(18);y=y.subtract(l.pow(3).multiply(m).multiply(4)),y=y.add(l.pow(2).multiply(u.pow(2))),y=y.subtract(n.multiply(u.pow(3)).multiply(4)),y=y.subtract(n.pow(2).multiply(m.pow(2)).multiply(27));var d=l.pow(2).subtract(n.multiply(u).multiply(3));if(0===y.valueOf()){if(0===d.valueOf()){var c=l.multiply(-1).divide(n.multiply(3));return[c.reduce()]}var c=n.multiply(l).multiply(u).multiply(4);c=c.subtract(n.pow(2).multiply(m).multiply(9)),c=c.subtract(l.pow(3)),c=c.divide(n.multiply(d));var f=n.multiply(m).multiply(9).subtract(l.multiply(u)).divide(d.multiply(2));return[c.reduce(),f.reduce()]}var v=(3*(u/n)-Math.pow(l,2)/Math.pow(n,2))/3,b=2*Math.pow(l,3)/Math.pow(n,3);b-=9*l*u/Math.pow(n,2),b+=27*m/n,b/=27;var w=Math.pow(b,2)/4+Math.pow(v,3)/27;if(w>0){var _=-(b/2)+Math.sqrt(w),E=Math.cbrt(_),q=-(b/2)-Math.sqrt(w),M=Math.cbrt(q),c=E+M-l/(3*n);if(0>c){var x=Math.floor(c);1e-15>c-x&&(c=x)}else if(c>0){var x=Math.ceil(c);1e-15>x-c&&(c=x)}return[c]}var a=Math.sqrt(Math.pow(b,2)/4-w),g=Math.cbrt(a),V=Math.acos(-(b/(2*a))),C=-g,O=Math.cos(V/3),D=Math.sqrt(3)*Math.sin(V/3),I=-(l/(3*n)),c=2*g*Math.cos(V/3)-l/(3*n),f=C*(O+D)+I,T=C*(O-D)+I;if(0>c){var x=Math.floor(c);1e-15>c-x&&(c=x)}else if(c>0){var x=Math.ceil(c);1e-15>x-c&&(c=x)}if(0>f){var P=Math.floor(f);1e-15>f-P&&(f=P)}else if(f>0){var P=Math.ceil(f);1e-15>P-f&&(f=P)}if(0>c){var S=Math.floor(T);1e-15>T-S&&(T=S)}else if(T>0){var S=Math.ceil(T);1e-15>S-T&&(T=S)}var F=[c,f,T];return F.sort(function(t,r){return t-r}),[F[0],F[1],F[2]]}},Equation.prototype.eval=function(t){return new Equation(this.lhs.eval(t),this.rhs.eval(t))},Equation.prototype.toString=function(){return this.lhs.toString()+" = "+this.rhs.toString()},Equation.prototype.toTex=function(){return this.lhs.toTex()+" = "+this.rhs.toTex()},Equation.prototype._maxDegree=function(){var t=this.lhs._maxDegree(),r=this.rhs._maxDegree();return Math.max(t,r)},Equation.prototype._maxDegreeOfVariable=function(t){return Math.max(this.lhs._maxDegreeOfVariable(t),this.rhs._maxDegreeOfVariable(t))},Equation.prototype._variableCanBeIsolated=function(t){return 1===this._maxDegreeOfVariable(t)&&this._noCrossProductsWithVariable(t)},Equation.prototype._noCrossProductsWithVariable=function(t){return this.lhs._noCrossProductsWithVariable(t)&&this.rhs._noCrossProductsWithVariable(t)},Equation.prototype._noCrossProducts=function(){return this.lhs._noCrossProducts()&&this.rhs._noCrossProducts()},Equation.prototype._onlyHasVariable=function(t){return this.lhs._onlyHasVariable(t)&&this.rhs._onlyHasVariable(t)},Equation.prototype._isLinear=function(){return 1===this._maxDegree()&&this._noCrossProducts()},Equation.prototype._isQuadratic=function(t){return 2===this._maxDegree()&&this._onlyHasVariable(t)},Equation.prototype._isCubic=function(t){return 3===this._maxDegree()&&this._onlyHasVariable(t)},module.exports=Equation;
